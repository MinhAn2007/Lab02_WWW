<!DOCTYPE html>
<html>
<head>
    <title>Product List</title>
</head>
<body>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    h1 {
        text-align: center;
    }

    #productList {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        justify-content: center;
    }

    .product {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
    }

    .product img {
        max-width: 100%;
        height: 200px; /* Set a fixed height for all images */
    }

    .price {
        font-weight: bold;
        color: green;
    }
</style>
<h1>Product List</h1>
<div id="productList">
    <!-- Product items will be displayed here -->
</div>
<button onclick="cartS()">Cart</button>
<script>
    var cart = [];
    var total = 0;

    // Function to fetch product data from the API
    function fetchProducts() {
        fetch("http://localhost:8080/api/products/all")
            .then(response => response.json())
            .then(data => displayProducts(data))
            .catch(error => console.error("Error fetching products: " + error));
    }

    function getPrice(id, productDiv) {
        return new Promise((resolve, reject) => {
            fetch(`http://localhost:8080/api/productPrices/last/${id}`)
                .then(response => response.json())
                .then(data => {
                    var price = parseFloat(data); // Convert the price to a floating-point number
                    // Gọi hàm để hiển thị giá hoặc thực hiện thêm bất kỳ xử lý nào bạn muốn ở đây
                    displayPrice(price, productDiv);
                    resolve(price); // Resolve the promise with the price value
                })
                .catch(error => {
                    console.error("Error fetching product price: " + error);
                    reject(error); // Reject the promise if there's an error
                });
        });
    }

    function getSrc(id, productDiv) {
        fetch(`http://localhost:8080/api/productImages/${id}`).then (response => response.json()).then(data => {
            var src = data.path; // Lấy đường dẫn hình ảnh từ dữ liệu trả về

            // Gọi hàm để hiển thị đường dẫn hình ảnh hoặc thực hiện thêm bất kỳ xử lý nào bạn muốn ở đây
            var imgElement = productDiv.querySelector("img");
            imgElement.src = src; // Đặt đường dẫn hình ảnh trong thuộc tính src
        })
            .catch(error => console.error("Error fetching product image: " + error));
    }

    // Hàm để hiển thị giá lên trang web
    function displayPrice(price, productDiv) {
        // Ví dụ: Hiển thị giá trên trang web
        var priceElement = productDiv.querySelector(".price");
        priceElement.innerText = `$${price}`;
    }

    function displayProducts(products) {
        var productList = document.getElementById("productList");
        products.forEach(function (product, index) {
            var productDiv = document.createElement("div");
            productDiv.className = "product";
            productDiv.innerHTML = `
            <h2>${product.name}</h2>
            <img src="">
            <p>Description: ${product.description}</p>
            <p class="price"></p>
            <button onclick="addToCart('${product.name}', '${product.product_id}', ${index})">Add to Cart</button>
        `;

            productList.appendChild(productDiv);
            getPrice(product.product_id, productDiv);
            getSrc(product.product_id, productDiv);

        });
    }

    function addToCart(productName, price, index) {
        // Check if the product is already in the cart
        const existingProduct = cart.find(item => item.name === productName);

        if (existingProduct) {
            // If the product is already in the cart, update its quantity
            existingProduct.price += parseFloat(price);
        } else {
            // If the product is not in the cart, add it as a new entry
            cart.push({ name: productName, price: parseFloat(price) });
        }

        // Update the total
        total += parseFloat(price);

        // Store the updated cart data in local storage
        localStorage.setItem('cart', JSON.stringify(cart));

        // You may want to update the cart display here
    }


    // After calling updateCart, redirect to the cart page
    function cartS() {
        // ... (your existing code)

        // Redirect to the cart page
        window.location.href = 'cart.html';
    }

    fetchProducts();

</script>
</body>
</html>
